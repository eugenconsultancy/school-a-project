{% extends 'accounts/base.html' %}

{% block content %}
<h2>My Academic Results</h2>

<div style="background-color: #e8f5e9; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
    <h3>Student Information</h3>
    <p><strong>Name:</strong> {{ student.user.get_full_name }}</p>
    <p><strong>Admission Number:</strong> {{ student.admission_number }}</p>
    <p><strong>Class:</strong> {{ student.grade }}-{{ student.section }}</p>
    
    <div style="display: flex; gap: 20px; margin-top: 15px;">
        <div style="background-color: white; padding: 15px; border-radius: 5px; flex: 1;">
            <h4 style="margin-top: 0;">Overall Performance</h4>
            <p><strong>Average Score:</strong> <span style="font-size: 24px; font-weight: bold;">{{ average_score|floatformat:2 }}%</span></p>
            <p><strong>Subjects Taken:</strong> {{ total_subjects }}</p>
            <p><strong>Subjects Passed:</strong> {{ passed_subjects }}</p>
        </div>
    </div>
</div>

<h3>Subject Marks</h3>
<table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th style="border: 1px solid #ddd; padding: 8px;">Subject</th>
            <th style="border: 1px solid #ddd; padding: 8px;">CAT1</th>
            <th style="border: 1px solid #ddd; padding: 8px;">CAT2</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Main Exam</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Total Score</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Grade</th>
            <th style="border: 1px solid #ddd; padding: 8px;">Term/Year</th>
        </tr>
    </thead>
    <tbody>
        {% for mark in marks %}
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">{{ mark.subject.name }}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ mark.cat1_score|default:"-" }}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ mark.cat2_score|default:"-" }}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ mark.main_exam_score }}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">{{ mark.total_score }}%</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                <span style="
                    display: inline-block;
                    padding: 2px 8px;
                    border-radius: 3px;
                    color: white;
                    {% if mark.grade == 'A' %}background-color: #4CAF50;
                    {% elif mark.grade == 'B' %}background-color: #8BC34A;
                    {% elif mark.grade == 'C' %}background-color: #FFC107;
                    {% elif mark.grade == 'D' %}background-color: #FF9800;
                    {% elif mark.grade == 'E' %}background-color: #FF5722;
                    {% else %}background-color: #f44336;
                    {% endif %}
                ">
                    {{ mark.grade }}
                </span>
            </td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{ mark.term }} {{ mark.academic_year }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" style="border: 1px solid #ddd; padding: 8px; text-align: center;">No marks recorded yet.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if reports %}
<h3>Term Reports</h3>
{% for report in reports %}
<div style="background-color: #f9f9f9; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
    <h4>{{ report.term }} {{ report.academic_year }} Report</h4>
    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <p><strong>Average Score:</strong> {{ report.average_score }}%</p>
            <p><strong>Overall Grade:</strong> {{ report.get_overall_grade_display }}</p>
            <p><strong>Class Position:</strong> {{ report.class_position }}/{{ report.total_students }}</p>
            <p><strong>Attendance:</strong> {{ report.days_present }}/{{ report.total_days }} days</p>
        </div>
        <div style="flex: 2;">
            <p><strong>Teacher's Comment:</strong><br>{{ report.teacher_comment|linebreaks }}</p>
            {% if report.principal_comment %}
            <p><strong>Principal's Comment:</strong><br>{{ report.principal_comment|linebreaks }}</p>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<div style="background-color: #fff3e0; padding: 15px; border-radius: 5px; margin-top: 20px;">
    <p><strong>Note:</strong> As a student, you can only view your marks. You cannot edit or manipulate any results.</p>
    <p>If you notice any discrepancies, please contact your teacher or the school administration.</p>
</div>
{% endblock %}